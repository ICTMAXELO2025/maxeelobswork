<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Notifications - Admin</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <style>
        /* Base Styles */
        :root {
            --primary-color: #667eea;
            --primary-dark: #5a6fd8;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --gray-color: #6c757d;
            --border-radius: 12px;
            --box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header Styles */
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 0;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.5s ease;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .user-info span {
            font-weight: 500;
        }

        /* Button Styles */
        .btn, .btn-small {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            text-align: center;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .btn:hover, .btn-small:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        /* Main Container */
        .dashboard-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            animation: fadeIn 0.7s ease;
        }

        /* Alert Styles */
        .alert {
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: var(--border-radius);
            animation: slideIn 0.5s ease;
            border-left: 4px solid;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border-left-color: var(--success-color);
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border-left-color: var(--danger-color);
        }

        /* Form Container */
        .form-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            animation: slideUp 0.6s ease;
            position: relative;
        }

        .form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--warning-color), #ff8c00);
        }

        .form-container h3 {
            margin-bottom: 25px;
            color: var(--dark-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-container h3::before {
            content: 'üì¢';
            font-size: 1.2em;
            color: var(--warning-color);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-group input[type="text"],
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            resize: vertical;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--warning-color);
            box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.2);
        }

        /* File Upload Styles */
        .file-upload {
            border: 2px dashed #ddd;
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            transition: var(--transition);
            margin-bottom: 25px;
        }

        .file-upload:hover {
            border-color: var(--warning-color);
            background: rgba(255, 193, 7, 0.05);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload label {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            color: var(--gray-color);
        }

        .file-upload label i {
            font-size: 3rem;
            margin-bottom: 10px;
            color: var(--warning-color);
        }

        .file-preview {
            margin-top: 15px;
            padding: 15px;
            background: var(--light-color);
            border-radius: var(--border-radius);
            display: none;
        }

        .file-preview.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .file-icon {
            font-size: 2rem;
        }

        .file-details {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
            color: var(--dark-color);
        }

        .file-size {
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        .remove-file {
            color: var(--danger-color);
            cursor: pointer;
            font-weight: bold;
        }

        /* Character Counter */
        .char-counter {
            text-align: right;
            margin-top: 5px;
            color: var(--gray-color);
            font-size: 0.9rem;
            transition: var(--transition);
            height: 20px;
        }

        .char-counter.warning {
            color: var(--warning-color);
            font-weight: 500;
        }

        .char-counter.danger {
            color: var(--danger-color);
            font-weight: 600;
        }

        /* Notification Preview */
        .notification-preview {
            background: #fff9e6;
            border: 2px dashed var(--warning-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            animation: fadeIn 0.8s ease;
        }

        .notification-preview h4 {
            color: var(--dark-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-preview h4::before {
            content: 'üëÅÔ∏è';
        }

        .preview-title {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ffeaa7;
        }

        .preview-message {
            color: var(--dark-color);
            line-height: 1.5;
            white-space: pre-wrap;
            margin-bottom: 15px;
        }

        .file-attachment-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
        }

        .file-attachment-preview i {
            color: var(--warning-color);
            font-size: 1.5rem;
        }

        /* Quick Templates */
        .quick-templates {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
            animation: slideUp 0.7s ease;
        }

        .quick-templates h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quick-templates h3::before {
            content: '‚ö°';
            font-size: 1.2em;
        }

        .template-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .template-btn {
            background: var(--light-color);
            border: 2px solid transparent;
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: left;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .template-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* Send Button Special Styling */
        .send-btn {
            background: linear-gradient(135deg, var(--warning-color), #ff8c00);
            color: black;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .send-btn:hover {
            background: linear-gradient(135deg, #e0a800, #e67e00);
            transform: translateY(-3px);
        }

        .send-btn::before {
            content: 'üì¢';
            margin-right: 8px;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .user-info {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }

            .user-info .btn-small {
                width: 100%;
            }

            .dashboard-container {
                margin: 15px auto;
                padding: 0 15px;
            }

            .form-container, .quick-templates {
                padding: 20px;
            }

            .template-buttons {
                grid-template-columns: 1fr;
            }

            .btn, .btn-small {
                padding: 12px 15px;
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .logo h2 {
                font-size: 1.2rem;
            }

            .form-container h3, .quick-templates h3 {
                font-size: 1.2rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header class="dashboard-header">
        <div class="header-content">
            <div class="logo">
                <h2>Send Notifications - Admin Dashboard</h2>
            </div>
            <div class="user-info">
                <span>Welcome, {{ current_user.name }} {{ current_user.surname }}</span>
                <a href="{{ url_for('admin_dashboard') }}" class="btn-small">Dashboard</a>
                <a href="{{ url_for('logout') }}" class="btn-small">Logout</a>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category == 'success' else 'error' }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Quick Templates -->
        <div class="quick-templates">
            <h3>Quick Templates</h3>
            <div class="template-buttons">
                <button class="template-btn" onclick="loadTemplate('meeting')">
                    <strong>Meeting Announcement</strong><br>
                    Schedule updates and reminders
                </button>
                <button class="template-btn" onclick="loadTemplate('document')">
                    <strong>Document Upload</strong><br>
                    Share important files
                </button>
                <button class="template-btn" onclick="loadTemplate('urgent')">
                    <strong>Urgent Update</strong><br>
                    Critical information alerts
                </button>
                <button class="template-btn" onclick="loadTemplate('general')">
                    <strong>General Announcement</strong><br>
                    Company-wide updates
                </button>
            </div>
        </div>

        <div class="form-container">
            <h3>Send Notification to All Employees</h3>
            <form method="POST" id="notificationForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="title">Notification Title:</label>
                    <input type="text" id="title" name="title" required placeholder="Enter a clear and concise title...">
                </div>
                
                <div class="form-group">
                    <label for="message">Message:</label>
                    <textarea id="message" name="message" rows="6" required placeholder="Type your notification message here..."></textarea>
                    <div class="char-counter" id="charCounter">0 characters</div>
                </div>
                
                <!-- File Upload Section -->
                <div class="file-upload">
                    <input type="file" id="fileInput" name="file" accept=".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.jpg,.jpeg,.png,.gif">
                    <label for="fileInput">
                        <i>üìé</i>
                        <span><strong>Attach File (Optional)</strong></span>
                        <small>Click to upload PDF, Word, Excel, PowerPoint, or images</small>
                    </label>
                    
                    <div class="file-preview" id="filePreview">
                        <div class="file-info">
                            <div class="file-icon" id="fileIcon">üìÑ</div>
                            <div class="file-details">
                                <div class="file-name" id="fileName"></div>
                                <div class="file-size" id="fileSize"></div>
                            </div>
                            <div class="remove-file" onclick="removeFile()">‚úï</div>
                        </div>
                    </div>
                </div>
                
                <!-- Notification Preview -->
                <div class="notification-preview" id="notificationPreview" style="display: none;">
                    <h4>Preview</h4>
                    <div class="preview-title" id="previewTitle"></div>
                    <div class="preview-message" id="previewMessage"></div>
                    <div class="file-attachment-preview" id="fileAttachmentPreview" style="display: none;">
                        <i>üìé</i>
                        <span id="attachmentName"></span>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn send-btn">Send Notification to All Employees</button>
                    <a href="{{ url_for('admin_dashboard') }}" class="btn" style="background: var(--gray-color);">Dashboard</a>
                    <a href="{{ url_for('admin_view_notifications') }}" class="btn" style="background: var(--info-color);">View Sent Notifications</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Character counter for message
        const messageTextarea = document.getElementById('message');
        const charCounter = document.getElementById('charCounter');
        const notificationPreview = document.getElementById('notificationPreview');
        const previewTitle = document.getElementById('previewTitle');
        const previewMessage = document.getElementById('previewMessage');
        const titleInput = document.getElementById('title');
        const fileInput = document.getElementById('fileInput');
        const filePreview = document.getElementById('filePreview');
        const fileAttachmentPreview = document.getElementById('fileAttachmentPreview');
        const attachmentName = document.getElementById('attachmentName');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const fileIcon = document.getElementById('fileIcon');

        // File upload handling
        fileInput.addEventListener('change', function(e) {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                const fileNameText = file.name;
                const fileSizeText = formatFileSize(file.size);
                const fileType = getFileType(fileNameText);
                
                // Update file preview
                fileName.textContent = fileNameText;
                fileSize.textContent = fileSizeText;
                fileIcon.textContent = getFileIcon(fileType);
                filePreview.classList.add('visible');
                
                // Update attachment preview
                attachmentName.textContent = `Attachment: ${fileNameText}`;
                fileAttachmentPreview.style.display = 'flex';
                
                updatePreview();
            }
        });

        function removeFile() {
            fileInput.value = '';
            filePreview.classList.remove('visible');
            fileAttachmentPreview.style.display = 'none';
            updatePreview();
        }

        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'image';
            if (['pdf'].includes(ext)) return 'pdf';
            if (['doc', 'docx'].includes(ext)) return 'word';
            if (['ppt', 'pptx'].includes(ext)) return 'powerpoint';
            if (['xls', 'xlsx'].includes(ext)) return 'excel';
            return 'document';
        }

        function getFileIcon(fileType) {
            const icons = {
                'image': 'üñºÔ∏è',
                'pdf': 'üìï',
                'word': 'üìù',
                'powerpoint': 'üìä',
                'excel': 'üìà',
                'document': 'üìÑ'
            };
            return icons[fileType] || 'üìÑ';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        messageTextarea.addEventListener('input', function() {
            const length = this.value.length;
            charCounter.textContent = `${length} characters`;
            
            // Update preview
            updatePreview();
            
            // Change color based on length
            if (length > 500) {
                charCounter.classList.add('danger');
                charCounter.classList.remove('warning');
            } else if (length > 300) {
                charCounter.classList.add('warning');
                charCounter.classList.remove('danger');
            } else {
                charCounter.classList.remove('warning', 'danger');
            }
        });

        titleInput.addEventListener('input', updatePreview);

        function updatePreview() {
            const title = titleInput.value;
            const message = messageTextarea.value;
            const file = fileInput.files[0];
            
            if (title || message || file) {
                notificationPreview.style.display = 'block';
                previewTitle.textContent = title || 'No title set';
                previewMessage.textContent = message || 'No message content yet';
            } else {
                notificationPreview.style.display = 'none';
            }
        }

        // Quick template loader
        function loadTemplate(type) {
            const templates = {
                meeting: {
                    title: "Important Meeting Announcement",
                    message: "Dear Team,\n\nWe have an important meeting scheduled for this week. Please ensure you:\n\n‚Ä¢ Review the agenda beforehand\n‚Ä¢ Come prepared with updates\n‚Ä¢ Arrive on time\n\nBest regards,\nManagement"
                },
                document: {
                    title: "Important Document Upload",
                    message: "Hello Everyone,\n\nI have uploaded an important document that requires your attention.\n\nPlease review the attached file and take necessary actions as outlined in the document.\n\nIf you have any questions, don't hesitate to reach out.\n\nThank you."
                },
                urgent: {
                    title: "URGENT: Important Update",
                    message: "URGENT NOTICE\n\nThis is an important update that requires your immediate attention:\n\n‚Ä¢ Please review the attached document\n‚Ä¢ Take appropriate action by the deadline\n‚Ä¢ Contact your manager if you have questions\n\nThank you for your prompt attention to this matter."
                },
                general: {
                    title: "Company Announcement",
                    message: "Hello Team,\n\nWe have some important updates to share with everyone:\n\n1. Please see the attached document for details\n2. Review the information carefully\n3. Let us know if you have any questions\n\nWe appreciate your continued hard work and dedication.\n\nBest regards,\nThe Management Team"
                }
            };

            if (templates[type]) {
                titleInput.value = templates[type].title;
                messageTextarea.value = templates[type].message;
                updatePreview();
                
                // Scroll to form
                document.querySelector('.form-container').scrollIntoView({ 
                    behavior: 'smooth' 
                });
            }
        }

        // Form submission with loading state
        document.getElementById('notificationForm').addEventListener('submit', function(e) {
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span> Sending Notification...';
            
            // Re-enable after 5 seconds (in case of error)
            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }, 5000);
        });

        // Auto-expand textarea as user types
        messageTextarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Add animation on load
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-focus on title field
            titleInput.focus();
            
            // Add pulse animation to send button
            const sendBtn = document.querySelector('.send-btn');
            sendBtn.style.animation = 'pulse 2s ease 3';
        });

        // Keyboard shortcut - Ctrl + Enter to submit
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('notificationForm').submit();
            }
        });

        // Drag and drop file upload
        const fileUpload = document.querySelector('.file-upload');
        
        fileUpload.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = 'var(--warning-color)';
            this.style.background = 'rgba(255, 193, 7, 0.1)';
        });

        fileUpload.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.style.borderColor = '#ddd';
            this.style.background = '';
        });

        fileUpload.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '#ddd';
            this.style.background = '';
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            }
        });
    </script>
</body>
</html>